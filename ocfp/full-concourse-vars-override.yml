---
params:
  external_domain: (( vault meta.ocfp.vault.tf "/lbs/concourse:domain" ))

  num_web_nodes: 1
  worker: 3

  concourse_network:   (( concat genesis.env "-concourse" ))
  concourse_disk_type: (( concat "concourse-" meta.ocfp.env.scale ))

  concourse_vm_type:   (( concat "concourse-" meta.ocfp.env.scale ))
  worker_vm_type:      (( concat "concourse-worker-" meta.ocfp.env.scale ))

---
- type: replace
  path: /instance_groups/name=web/vm_extensions?/-
  value: concourse-lb

- type: replace
  path: /instance_groups/name=web/networks?
  value:
    - name: (( concat genesis.env "-concourse" ))
      static_ips:
        - (( grab meta.ocfp.concourse.ip ))

